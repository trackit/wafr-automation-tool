openapi: 3.0.3
info:
  title: Assessment API
  version: 1.0.0
  description: |
    This API provides endpoints for managing assessments in a structured and efficient manner.
    You can create, retrieve, and delete assessments, as well as manage associated findings, best practices, and questions.
paths:
  /assessments:
    get:
      tags:
        - Assessments
      summary: Retrieve a list of all assessments
      description: |
        Retrieves all assessments that have been created in the system.
        Useful for monitoring and managing multiple assessments in one place.
      parameters:
        - name: limit
          in: query
          description: Maximum number of assessments to return
          schema:
            type: integer
            default: 10
        - name: search
          in: query
          description: Search term to filter assessments by name, role ARN, or id
          schema:
            type: string
        - name: next_token
          in: query
          description: Token for pagination.
          schema:
            type: string
      responses:
        "200":
          description: List of all assessments
          content:
            application/json:
              schema:
                type: object
                properties:
                  assessments:
                    type: array
                    items:
                      $ref: "#/components/schemas/Assessment"
                  next_token:
                    type: string
                    description: |
                      Token for pagination. If there are more assessments than can be returned in a single response,
                      this token will allow you to retrieve the next set of results.
        "500":
          description: Internal server error.
    post:
      tags:
        - Assessments
      summary: Start a new assessment process
      description: |
        Initiates a new assessment for a given role.
        You can specify a role ARN for the assessment, or a default role will be used.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  description: Name of the assessment to be created
                regions:
                  type: array
                  items:
                    type: string
                  description: |
                    List of regions to scan
                    If empty, all regions will be scanned
                roleArn:
                  type: string
                  description: |
                    The role ARN to associate with the assessment.
                    If not provided, a default role will be used.
                workflows:
                  type: array
                  items:
                    type: string
                  description: |
                    The workflows to associate with the assessment.
                    If not provided, no workflows will be associated.
      responses:
        "201":
          description: The assessment has been successfully created
          content:
            application/json:
              schema:
                type: object
                properties:
                  assessment_id:
                    type: integer
                    description: The unique ID of the newly created assessment
        "400":
          description: Bad Request. Missing or invalid parameters were provided.
        "500":
          description: Internal server error.

  /assessments/{assessmentId}:
    get:
      tags:
        - Assessments
      summary: Retrieve details of a specific assessment
      description: |
        Retrieves detailed information about a specific assessment,
        including associated findings, questions, and any current errors.
      parameters:
        - name: assessmentId
          in: path
          description: The unique ID of the assessment to retrieve
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Detailed information about the specified assessment
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AssessmentContent"
        "404":
          description: The specified assessment could not be found
        "500":
          description: Internal server error.
    put:
      tags:
        - Assessments
      summary: Update the details of a specific assessment
      description: |
        Updates the details of a specific assessment, such as the name or role ARN.
      parameters:
        - name: assessmentId
          in: path
          description: The unique ID of the assessment to update
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssessmentDto"
      responses:
        "200":
          description: The assessment has been successfully updated
        "400":
          description: Invalid request body
        "500":
          description: Internal server error.
    post:
      tags:
        - Assessments
      summary: Rescan an assessment
      description: |
        Rescans an assessment, updating the findings and best practices.
      parameters:
        - name: assessmentId
          in: path
          description: The unique ID of the assessment to rescan
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: The assessment has been successfully rescanned
        "404":
          description: The specified assessment could not be found
        "500":
          description: Internal server error.
    delete:
      tags:
        - Assessments
      summary: Delete a specific assessment
      description: |
        Deletes an assessment from the system.
        Once deleted, the assessment cannot be recovered.
      parameters:
        - name: assessmentId
          in: path
          description: The unique ID of the assessment to delete
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: The assessment has been successfully deleted
        "404":
          description: The specified assessment could not be found
        "500":
          description: Internal server error.

  /assessments/{assessmentId}/exports/well-architected-tool:
    post:
      tags:
        - Exports
      summary: Export the assessment to Well Architected Tool
      description: |
        Exports the assessment to Well Architected Tool.
        You can specify an owner for the workload and a name for the assessment.
      parameters:
        - name: assessmentId
          in: path
          description: The unique ID of the assessment to export
          required: true
          schema:
            type: integer
        - name: owner
          in: query
          description: The owner of the workload
          schema:
            type: string
      responses:
        "200":
          description: The assessment has been successfully exported
        "400":
          description: Invalid request body
        "404":
          description: The specified assessment could not be found
        "500":
          description: Internal server error.

  /assessments/{assessmentId}/pillars/{pillarId}:
    put:
      tags:
        - Pillars
      summary: Update the details of a specific pillar
      description: |
        Updates the details of a specific pillar.
      parameters:
        - name: assessmentId
          in: path
          required: true
          description: The ID of the assessment
          schema:
            type: integer
        - name: pillarId
          in: path
          required: true
          description: The ID of the pillar
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PillarDto"
      responses:
        "200":
          description: The pillar has been successfully updated
        "400":
          description: Invalid request body
        "404":
          description: The specified assessment, or pillar could not be found
        "500":
          description: Internal server error.

  /assessments/{assessmentId}/pillars/{pillarId}/questions/{questionId}:
    put:
      tags:
        - Questions
      summary: Update the details of a specific question
      description: |
        Updates the details of a specific question.
      parameters:
        - name: assessmentId
          in: path
          required: true
          description: The ID of the assessment
          schema:
            type: integer
        - name: pillarId
          in: path
          required: true
          description: The ID of the pillar under which the question falls
          schema:
            type: integer
        - name: questionId
          in: path
          required: true
          description: The ID of the question
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/QuestionDto"
      responses:
        "200":
          description: The question has been successfully updated
        "400":
          description: Invalid request body
        "404":
          description: The specified assessment, pillar, or question could not be found
        "500":
          description: Internal server error.

  /assessments/{assessmentId}/pillars/{pillarId}/questions/{questionId}/best-practices/{bestPracticeId}:
    get:
      tags:
        - Best Practices
      summary: Retrieve all findings for a specific best practice
      description: |
        Fetches all the findings associated with a specific best practice within a question in a given pillar for a specific assessment.
      parameters:
        - name: assessmentId
          in: path
          required: true
          description: The ID of the assessment
          schema:
            type: integer
        - name: pillarId
          in: path
          required: true
          description: The ID of the pillar under which the question falls
          schema:
            type: integer
        - name: questionId
          in: path
          required: true
          description: The ID of the question to retrieve the best practices to
          schema:
            type: integer
        - name: bestPracticeId
          in: path
          required: true
          description: The ID of the best practice to retrieve findings to
          schema:
            type: integer
      responses:
        "200":
          description: A list of findings related to the specified best practice
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BestPracticeExtra"
        "404":
          description: The specified best practice could not be found
    put:
      tags:
        - Best Practices
      summary: Update the details of a specific best practice
      description: |
        Updates the details of a specific best practice.
      parameters:
        - name: assessmentId
          in: path
          required: true
          description: The ID of the assessment
          schema:
            type: integer
        - name: pillarId
          in: path
          required: true
          description: The ID of the pillar under which the question falls
          schema:
            type: integer
        - name: questionId
          in: path
          required: true
          description: The ID of the question to update the best practice to
          schema:
            type: integer
        - name: bestPracticeId
          in: path
          required: true
          description: The ID of the best practice
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BestPracticeDto"
      responses:
        "200":
          description: The best practice has been successfully updated
        "400":
          description: Invalid request body
        "404":
          description: The specified assessment, pillar, question, or best practice could not be found
        "500":
          description: Internal server error.

  ? /assessments/{assessmentId}/pillars/{pillarId}/questions/{questionId}/best-practices/{bestPracticeId}/findings/{findingId}
  : put:
      tags:
        - Best Practices
      summary: Update the details of a specific finding
      description: |
        Updates the details of a specific finding.
      parameters:
        - name: assessmentId
          in: path
          required: true
          description: The ID of the assessment to which the finding belongs
          schema:
            type: integer
        - name: pillarId
          in: path
          required: true
          description: The ID of the pillar under which the question falls
          schema:
            type: integer
        - name: questionId
          in: path
          required: true
          description: The ID of the question to update the best practice to
          schema:
            type: integer
        - name: bestPracticeId
          in: path
          required: true
          description: The ID of the best practice to update the status to
          schema:
            type: integer
        - name: findingId
          in: path
          required: true
          description: The unique ID of the finding to retrieve
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FindingDto"
      responses:
        "200":
          description: The finding has been successfully updated
        "400":
          description: Invalid request body
        "404":
          description: The specified assessment could not be found
        "500":
          description: Internal server error.

  /assessments/{assessmentId}/findings/{findingId}:
    get:
      tags:
        - Findings
      summary: Retrieve the details of a specific finding
      description: |
        Fetches detailed information about a specific finding related to an assessment,
        including severity, status, and recommended remediation steps.
      parameters:
        - name: assessmentId
          in: path
          required: true
          description: The ID of the assessment to which the finding belongs
          schema:
            type: integer
        - name: findingId
          in: path
          required: true
          description: The unique ID of the finding to retrieve
          schema:
            type: string
      responses:
        "200":
          description: Detailed information about the specified finding
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Finding"
        "404":
          description: The specified assessment or finding could not be found
        "500":
          description: Internal server error.

components:
  schemas:
    Assessment:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier of the assessment
        name:
          type: string
          description: Name or title of the assessment
        regions:
          type: array
          items:
            type: string
          description: |
            List of regions to scan
            If empty, all regions will be scanned
        role_arn:
          type: string
          description: Role ARN associated with the assessment
        workflows:
          type: array
          items:
            type: string
          description: Workflows associated with the assessment
        created_at:
          type: string
          description: ISO-formatted date when the assessment was created
        graph_datas:
          type: object
          description: Processed data from the scanning tools
          additionalProperties: false
          properties:
            regions:
              type: object
              description: Regions where findings were found
            resource_types:
              type: object
              description: Resource types where findings were found
            severities:
              type: object
              description: Severity levels where findings were found
            findings:
              type: integer
              description: Total number of findings
        step:
          type: string
          description: Current step in the assessment process
          enum:
            - SCANNING_STARTED
            - PREPARING_PROMPTS
            - INVOKING_LLM
            - FINISHED
            - ERRORED
        error:
          $ref: "#/components/schemas/AssessmentError"
        question_version:
          type: string
          description: The version of questions that were used for the assessment
    AssessmentContent:
      type: object
      allOf:
        - $ref: "#/components/schemas/Assessment"
        - properties:
            findings:
              type: array
              description: A list of findings associated with the assessment
              items:
                $ref: "#/components/schemas/Pillar"
    AssessmentError:
      type: object
      nullable: true
      description: Error details if an issue occurred during the assessment process.
      properties:
        Error:
          type: string
        Cause:
          type: string
    AssessmentDto:
      type: object
      properties:
        name:
          type: string
          nullable: true
        role_arn:
          type: string
          nullable: true
    Finding:
      type: object
      description: A finding within an assessment, providing details on the issue found
      additionalProperties: false
      properties:
        id:
          type: integer
          description: Unique identifier of the finding
        severity:
          type: string
          description: Severity level of the finding (e.g., Low, Medium, High)
        status_code:
          type: string
          description: The status of the finding (e.g., MANUAL, FAIL)
        status_detail:
          type: string
          description: Explanation or additional details about the finding's status
        hidden:
          type: boolean
          description: Whether the finding is hidden or not
        resources:
          type: array
          description: List of resources related to the finding
          items:
            type: object
            additionalProperties: false
            properties:
              uid:
                type: string
                description: ARN or unique identifier of the resource
                nullable: true
              name:
                type: string
                description: Name of the resource
                nullable: true
              type:
                type: string
                description: Type of resource (e.g., S3Bucket)
                nullable: true
              region:
                type: string
                description: The region or location of the resource
                nullable: true
        remediation:
          type: object
          description: Remediation advice for resolving the issue found
          additionalProperties: false
          properties:
            desc:
              type: string
              description: Textual guidance on how to resolve the finding
            references:
              type: array
              description: List of resources (URLs, CLI commands) for remediation
              items:
                type: string
        risk_details:
          type: string
          description: Explanation of the risk associated with the finding
    FindingDto:
      type: object
      properties:
        hidden:
          type: boolean
          nullable: true
    Pillar:
      type: object
      additionalProperties: false
      properties:
        id:
          type: string
        label:
          type: string
        disabled:
          type: boolean
        questions:
          type: array
          items:
            $ref: "#/components/schemas/Question"
    PillarDto:
      type: object
      properties:
        disabled:
          type: boolean
          nullable: true
    Question:
      type: object
      additionalProperties: false
      properties:
        id:
          type: string
        label:
          type: string
        none:
          type: boolean
        disabled:
          type: boolean
        best_practices:
          type: array
          items:
            $ref: "#/components/schemas/BestPractice"
    QuestionDto:
      type: object
      properties:
        none:
          type: boolean
          nullable: true
        disabled:
          type: boolean
          nullable: true
    BestPractice:
      type: object
      description: A best practice related to a question and pillar in the assessment
      additionalProperties: false
      properties:
        id:
          type: string
        label:
          type: string
        risk:
          type: string
          enum:
            - "High"
            - "Medium"
            - "Low"
        description:
          type: string
        status:
          type: boolean
        results:
          type: array
          items:
            type: string
        hidden_results:
          type: array
          items:
            type: string
    BestPracticeExtra:
      type: object
      description: Enhanced best practice information, including associated findings
      allOf:
        - $ref: "#/components/schemas/BestPractice"
        - properties:
            results:
              type: array
              items:
                $ref: "#/components/schemas/Finding"
    BestPracticeDto:
      type: object
      properties:
        status:
          type: boolean
          nullable: true
